#!/usr/bin/env bpftrace

tracepoint:syscalls:sys_enter_openat
{
    printf("openat: %s\n", str(args.filename));
}

tracepoint:syscalls:sys_enter_openat2
{
    printf("openat2: %s\n", str(args->filename));
}

tracepoint:syscalls:sys_enter_openat
/ pid == 1234 /
{
    @opens[pid] = count();
}

tracepoint:syscalls:sys_enter_*
{
    @syscalls[comm] = count();
}

profile:hz:99
{
    @cpu_time[cpu] = count();
}

END
{
    clear(@opens);
    clear(@syscalls);
    clear(@cpu_time);
}
